# 试算辅助工具使用说明




## 一、使用前准备工作

### 1.wps宏安全设置
1.打开WPS找到工具栏的：工具-开发工具
![alt text](image-6.png)
2.点击宏安全性
![alt text](image-7.png)
3.全部勾选后确定
![alt text](image-8.png)


### 2.新纪元导出科目余额表说明

1.转到账户汇总窗口，  
勾选[默认年度空账户、默认含期间空账户、默认含期末平账户]
![alt text](image.png)

2.展开科目设置见下图(树状展开)
![alt text](image-19.png)

3.勾选"余额正负调整"
![alt text](image-2.png)

4.导出选择
![alt text](image-4.png)
5.推荐勾选设置（可随意选择）
![alt text](image-5.png)

### 3.【试算科余路径关系表】操作说明
1.此表是用来记录【科目余额表】和【试算底稿】的路径对应关系的，采用文件名的**前四位**作为索引号。<br>
！！！！请在导出科目余额表时尽量和试算底稿文件名称一致 ！！！！<br>
![alt text](image-17.png)
2.此xlsm文件在sheet<操作步骤>中有三个按钮，在导入科目余额表后，依此点击三按钮即可得到sheet<匹配结果>
![alt text](image-1.png)
3.sheet<匹配结果>示例如下
![alt text](image-18.png)


### 4.【试算报表路径关系表】操作说明
1.此表是用来记录【试算底稿】和【报表】的路径对应关系的，采用文件名的**前四位**作为索引号。<br>
！！！！请在导出报表时尽量和试算底稿文件名称一致 ！！！！<br>
2.此xlsm文件在sheet<操作步骤>中有三个按钮，在导入试算底稿后，依此点击此三个按钮即可得到sheet<匹配结果>
![alt text](image-20.png)
3.sheet<匹配结果>示例如下
![alt text](image-21.png)

### 5.【单元格映射】填写说明（对应：功能1.写入数据到试算底稿）
1.关键字段说明<br>
单元格：【试算底稿】的单元格<br>
账户代码：【科目余额表】的账户代码<br>
运算符：【科目余额表】的运算符（暂时只支持+、-）<br>
金额列：【科目余额表】的金额列(记得要用下划线，格式参考2.新纪元导出科目余额表说明)<br>
如sheet<原报表>第3行代表<br>
【试算底稿】的D9单元格=【科目余额表】的"库存现金"+"银行存款"+"其他货币资金"的"期末余额"<br>
![alt text](image-37.png)
2.填写说明<br>

**`!!!!!`分隔符只支持竖线，中间用空格没关系，但是不能用别的`!!!!!!`**<br>
账户代码：<br>
一个单元格由多个科目余额表项目构成，则填写多个代码，用竖线"|"分隔<br>
一个单元格由一个科目余额表项目构成，则填写1个代码<br>
运算符:
一个单元格由多个科目余额表项目构成，则填写多个运算符，用竖线"|"分隔<br>
一个单元格由一个科目余额表项目构成，则填写1个运算符<br>
金额列：
一个单元格由多个科目余额表项目构成，则填写多金额列，用竖线"|"分隔<br>
一个单元格由一个科目余额表项目构成，则填写1个金额列<br>





## 二、正式使用

### 功能1.写入数据到试算底稿
**`!!!!`强烈建议使用本功能前备份原始【试算底稿】文件`!!!!`**<br> 
**`!!!!`强烈建议使用本功能前备份原始【试算底稿】文件`!!!!`**<br>
**`!!!!`强烈建议使用本功能前备份原始【试算底稿】文件`!!!!`**<br>


#### 子功能1.单文件执行
1.选择"单文件执行"
![alt text](image-22.png)
2.上传【试算单元格映射表】
![alt text](image-9.png)
3.上传后会解析表格，让用户选择是否需要期初数，是否仅需要刷【试算底稿】的特定sheet。<br> 
如选择否,会将配置在【试算单元格映射表】中的全部sheet都刷到【试算底稿】中。
![alt text](image-10.png)
4.输入【科目余额表】、【试算底稿】文件路径 xlsx格式，**路径前后不要有双引号**
![alt text](image-11.png)
![alt text](image-12.png)
5.点击【执行】按钮，等待执行完成，查看结果
![alt text](image-23.png)
6."执行日志"该功能只针对<原报表>,**只有在<执行特定sheet?>选择"否"或"原报表"**时才会导出日志<br>
执行日志会记录哪些“一级科目”在【科目余额表】没有被刷到【试算底稿】，哪些有差异。<br>
理论上上如果科目余额表的科目都刷到原报表，日志只会出现"本年利润"和"利润分配"<br>
![alt text](image-24.png)


#### 子功能2.批量循环执行模式
1.选择"2.批量循环执行"
![alt text](image-25.png)
2.上传【试算单元格映射表】(已上传了不用重复上传了)
![alt text](image-13.png)
3.上传【试算科余路径关系表】
![alt text](image-14.png)
4.点击【执行】按钮，等待执行完成，查看结果  
！！！！执行过程中不要打开【试算底稿】会报错！！！！！
![alt text](image-15.png)

#### 子功能3.从财务报告更新试算<原报表>
从财务报告更新试算<原报表>
1.选择"3.从财务报告更新试算<原报表>"
![alt text](image-26.png)
2.上传【试算单元格映射表】
![alt text](image-28.png)
**这个映射表是根据东方生物的财报格式单独设计的，请和【科余】的映射表作区分**
![alt text](image-27.png)
**这个映射表是根据东方生物的财报格式单独设计的，账户代码这列不要动，暂不支持自由修改**
![alt text](image-29.png)
3.上传【试算财务报告关系表】
![alt text](image-30.png)
4.点击【执行】按钮，等待执行完成，查看结果
！！！！执行过程中不要打开【试算底稿】会报错！！！！！
![alt text](image-31.png)


### 功能2.从试算底稿提取数据

#### 子功能1.导出[销售、管理、研发费用底稿]
1.填写【试算底稿】文件夹路径、【费用底稿】文件保存路径
![alt text](image-32.png)
2.点击执行，等待结果输出
![alt text](image-33.png)

#### 子功能2.自定义批量导出数据
1.功能说明：
该功能可以批量从【试算底稿】中取数，即提取**全部公司**在自定义区域的数据<br>

取数默认会根据**文件名称**判断：
**1.默认不会选取带有"日志"、"合并"字样的文件**
**2.默认取文件名称作为"公司名称",公司名称会自动加到第一列**

2.excel区域与填写关系对照说明
若希望从【8】的A74到C90的区域取数：
下面是示例的excel
![alt text](image-34.png)
下面是工具的填写方式
![alt text](image-35.png)
3.点击执行等待结果输出
![alt text](image-36.png)